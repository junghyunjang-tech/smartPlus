version: "3.8"

services:
  # Spring Boot 애플리케이션
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: smartplus-app
    environment:
      # 데이터베이스 연결 정보 (호스트의 PostgreSQL 사용)
      # host.docker.internal은 Docker 컨테이너에서 호스트 머신에 접근하는 특수 DNS
      # Linux에서는 --add-host 옵션이 필요하거나 직접 IP 사용
      SPRING_DATASOURCE_URL: ${DB_URL:-jdbc:postgresql://host.docker.internal:5432/smartplus}
      SPRING_DATASOURCE_USERNAME: ${DB_USERNAME:-postgres}
      SPRING_DATASOURCE_PASSWORD: ${DB_PASSWORD:-postgres}
      # Jasypt 암호화 키 (환경변수로 관리)
      JASYPT_ENCRYPTOR_PASSWORD: ${JASYPT_ENCRYPTOR_PASSWORD:-sample_secret_key}
      # JPA 설정
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
      SPRING_JPA_SHOW_SQL: "true"
      # 애플리케이션 설정
      SPRING_PROFILES_ACTIVE: prod
    ports:
      - "80:8080"
    # Linux에서 host.docker.internal 사용을 위한 설정
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    volumes:
      # 로그 저장용 (선택사항)
      - app-logs:/app/logs

volumes:
  app-logs:
    driver: local
